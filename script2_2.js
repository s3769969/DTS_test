var presets = {
"PRESETS": [{
"VIEW_NAME": "FULL",
"UR": true,
"NAME": true,
"D.O.B": true,
"SEX": true,
"HOSPITAL_SITE": true,
"WARD/AREA": true,
"BED_NO": true,
"ADMITTING SPECIALTY": true,
"ADMITTING CONSULTANT": true,
"PATIENT CLINICAL DETAILS": false,
"ALLERGIES/ADR": true,
"ISOLATION PRECAUTIONS": true,
"ALERTS": true,
"DOSING WEIGHT": true,
"ENCOUNTER CLINICAL DETAILS": false,
"Goals of care status": true,
"Current Problem List": true,
"Chief complaint": true,
"Current referrals": true,
"Barriers to Discharge": true,
"EDD": true,
"Confirmed Discharge": true,
"Discharge Destination": true,
"Diet": true,
"Last known vitals": true,
"Altered calling criteria": true,
"Active medication Mx": true,
"Active Investigation Orders": true,
}, {
"VIEW_NAME": "MINIMAL",
"UR": true,
"NAME": true,
"D.O.B": true,
"SEX": true,
"HOSPITAL_SITE": false,
"WARD/AREA": false,
"BED_NO": true,
"ADMITTING SPECIALTY": true,
"ADMITTING CONSULTANT": true,
"PATIENT CLINICAL DETAILS": true,
"ALLERGIES/ADR": false,
"ISOLATION PRECAUTIONS": false,
"ALERTS": false,
"DOSING WEIGHT": false,
"ENCOUNTER CLINICAL DETAILS": true,
"Goals of care status": false,
"Current Problem List": false,
"Chief complaint": false,
"Current referrals": false,
"Barriers to Discharge": false,
"EDD": false,
"Confirmed Discharge": false,
"Discharge Destination": false,
"Diet": false,
"Last known vitals": false,
"Altered calling criteria": false,
"Active medication Mx": false,
"Active Investigation Orders": false,
}, {
"VIEW_NAME": "ALL",
"UR": true,
"NAME": true,
"D.O.B": true,
"SEX": true,
"HOSPITAL_SITE": true,
"WARD/AREA": true,
"BED_NO": true,
"ADMITTING SPECIALTY": true,
"ADMITTING CONSULTANT": true,
"PATIENT CLINICAL DETAILS": true,
"ALLERGIES/ADR": true,
"ISOLATION PRECAUTIONS": true,
"ALERTS": true,
"DOSING WEIGHT": true,
"ENCOUNTER CLINICAL DETAILS": true,
"Goals of care status": true,
"Current Problem List": true,
"Chief complaint": true,
"Current referrals": true,
"Barriers to Discharge": true,
"EDD": true,
"Confirmed Discharge": true,
"Discharge Destination": true,
"Diet": true,
"Last known vitals": true,
"Altered calling criteria": true,
"Active medication Mx": true,
"Active Investigation Orders": true,
}]
}

var list = {
"REC": {
"PAT": [{
"UR": 733924.000000,
"NAME": "Git, Hub ",
"D.O.B": "\/Date(1990-01-01T00:00:00.000+00:00)\/",
"SEX": "F",
"HOSPITAL_SITE": "Clayton",
"WARD/AREA": "ICU",
"BED_NO": "6",
"ADMITTING SPECIALTY": "General Medicine",
"ADMITTING CONSULTANT": "Doogie Howser",
"PATIENT CLINICAL DETAILS": "Click to expand",
"ALLERGIES/ADR": "Penecillin",
"ISOLATION PRECAUTIONS": "none",
"ALERTS": "none",
"DOSING WEIGHT": "X kg",
"ENCOUNTER CLINICAL DETAILS": "Click to expand",
"Goals of care status": "Pending",
"Current Problem List": "[Problem A, Problem B Problem C]",
"Chief complaint": "Chief compliant summary",
"Current referrals": "[Referral A:Status A, Referral B:Status B, Referral C:Status C]",
"Barriers to Discharge": "Text summary",
"EDD": "To be confirmed",
"Confirmed Discharge": "TBC",
"Discharge Destination": "TBC",
"Diet": "Normal",
"Last known vitals": "[BP:Value A, HR:Value B, Temp:Value C]",
"Altered calling criteria": "None",
"Active medication Mx": "Link to source/image",
"Active Investigation Orders": '[Pathology:"path text summary", Radiology:"rad text summary", Other:"other text summary.etc."]'
}, {
"UR": 2607950.000000,
"NAME": "John, Luke ",
"D.O.B": "\/Date(1991-01-01T00:00:00.000+00:00)\/",
"SEX": "M",
"HOSPITAL_SITE": "Dandenong",
"WARD/AREA": "ED",
"BED_NO": "6",
"ADMITTING SPECIALTY": "General Medicine",
"ADMITTING CONSULTANT": "Doogie Howser",
"PATIENT CLINICAL DETAILS": "Click to expand",
"ALLERGIES/ADR": "Penecillin",
"ISOLATION PRECAUTIONS": "none",
"ALERTS": "none",
"DOSING WEIGHT": "X kg",
"ENCOUNTER CLINICAL DETAILS": "Click to expand",
"Goals of care status": "Pending",
"Current Problem List": "[Problem A, Problem B Problem C]",
"Chief complaint": "Chief compliant summary",
"Current referrals": "[Referral A:Status A, Referral B:Status B, Referral C:Status C]",
"Barriers to Discharge": "Text summary",
"EDD": "To be confirmed",
"Confirmed Discharge": "TBC",
"Discharge Destination": "TBC",
"Diet": "Normal",
"Last known vitals": "[BP:Value A, HR:Value B, Temp:Value C]",
"Altered calling criteria": "None",
"Active medication Mx": "Link to source/image",
"Active Investigation Orders": '[Pathology:"path text summary", Radiology:"rad text summary", Other:"other text summary.etc."]'
}, {
"UR": 2601764.000000,
"NAME": "Pierce, Pierce ",
"D.O.B": "\/Date(1992-01-01T00:00:00.000+00:00)\/",
"SEX": "M",
"HOSPITAL_SITE": "Clayton",
"WARD/AREA": "ED",
"BED_NO": "6",
"ADMITTING SPECIALTY": "General Medicine",
"ADMITTING CONSULTANT": "Doogie Howser",
"PATIENT CLINICAL DETAILS": "Click to expand",
"ALLERGIES/ADR": "Penecillin",
"ISOLATION PRECAUTIONS": "none",
"ALERTS": "none",
"DOSING WEIGHT": "X kg",
"ENCOUNTER CLINICAL DETAILS": "Click to expand",
"Goals of care status": "Pending",
"Current Problem List": "[Problem A, Problem B Problem C]",
"Chief complaint": "Chief compliant summary",
"Current referrals": "[Referral A:Status A, Referral B:Status B, Referral C:Status C]",
"Barriers to Discharge": "Text summary",
"EDD": "To be confirmed",
"Confirmed Discharge": "TBC",
"Discharge Destination": "TBC",
"Diet": "Normal",
"Last known vitals": "[BP:Value A, HR:Value B, Temp:Value C]",
"Altered calling criteria": "None",
"Active medication Mx": "Link to source/image",
"Active Investigation Orders": '[Pathology:"path text summary", Radiology:"rad text summary", Other:"other text summary.etc."]'
}, {
"UR": 2605750.000000,
"NAME": "Hello, World ",
"D.O.B": "\/Date(1993-01-01T00:00:00.000+00:00)\/",
"SEX": "F",
"HOSPITAL_SITE": "Moorabbin",
"WARD/AREA": "ED",
"BED_NO": "6",
"ADMITTING SPECIALTY": "General Medicine",
"ADMITTING CONSULTANT": "Doogie Howser",
"PATIENT CLINICAL DETAILS": "Click to expand",
"ALLERGIES/ADR": "Penecillin",
"ISOLATION PRECAUTIONS": "none",
"ALERTS": "none",
"DOSING WEIGHT": "X kg",
"ENCOUNTER CLINICAL DETAILS": "Click to expand",
"Goals of care status": "Pending",
"Current Problem List": "[Problem A, Problem B Problem C]",
"Chief complaint": "Chief compliant summary",
"Current referrals": "[Referral A:Status A, Referral B:Status B, Referral C:Status C]",
"Barriers to Discharge": "Text summary",
"EDD": "To be confirmed",
"Confirmed Discharge": "TBC",
"Discharge Destination": "TBC",
"Diet": "Normal",
"Last known vitals": "[BP:Value A, HR:Value B, Temp:Value C]",
"Altered calling criteria": "None",
"Active medication Mx": "Link to source/image",
"Active Investigation Orders": '[Pathology:"path text summary", Radiology:"rad text summary", Other:"other text summary.etc."]'
}, {
"UR": 2605755.000000,
"NAME": "Saint, Vincent ",
"D.O.B": "\/Date(1994-01-01T00:00:00.000+00:00)\/",
"SEX": "M",
"HOSPITAL_SITE": "Clayton",
"WARD/AREA": "ED",
"BED_NO": "6",
"ADMITTING SPECIALTY": "General Medicine",
"ADMITTING CONSULTANT": "Doogie Howser",
"PATIENT CLINICAL DETAILS": "Click to expand",
"ALLERGIES/ADR": "Penecillin",
"ISOLATION PRECAUTIONS": "none",
"ALERTS": "none",
"DOSING WEIGHT": "X kg",
"ENCOUNTER CLINICAL DETAILS": "Click to expand",
"Goals of care status": "Pending",
"Current Problem List": "[Problem A, Problem B Problem C]",
"Chief complaint": "Chief compliant summary",
"Current referrals": "[Referral A:Status A, Referral B:Status B, Referral C:Status C]",
"Barriers to Discharge": "Text summary",
"EDD": "To be confirmed",
"Confirmed Discharge": "TBC",
"Discharge Destination": "TBC",
"Diet": "Normal",
"Last known vitals": "[BP:Value A, HR:Value B, Temp:Value C]",
"Altered calling criteria": "None",
"Active medication Mx": "Link to source/image",
"Active Investigation Orders": '[Pathology:"path text summary", Radiology:"rad text summary", Other:"other text summary.etc."]'
}, {
"UR": 2677951.000000,
"NAME": "Jeffrey, Jeff ",
"D.O.B": "\/Date(1995-01-01T00:00:00.000+00:00)\/",
"SEX": "M",
"HOSPITAL_SITE": "Clayton",
"WARD/AREA": "ED",
"BED_NO": "6",
"ADMITTING SPECIALTY": "General Medicine",
"ADMITTING CONSULTANT": "Doogie Howser",
"PATIENT CLINICAL DETAILS": "Click to expand",
"ALLERGIES/ADR": "Penecillin",
"ISOLATION PRECAUTIONS": "none",
"ALERTS": "none",
"DOSING WEIGHT": "X kg",
"ENCOUNTER CLINICAL DETAILS": "Click to expand",
"Goals of care status": "Pending",
"Current Problem List": "[Problem A, Problem B Problem C]",
"Chief complaint": "Chief compliant summary",
"Current referrals": "[Referral A:Status A, Referral B:Status B, Referral C:Status C]",
"Barriers to Discharge": "Text summary",
"EDD": "To be confirmed",
"Confirmed Discharge": "TBC",
"Discharge Destination": "TBC",
"Diet": "Normal",
"Last known vitals": "[BP:Value A, HR:Value B, Temp:Value C]",
"Altered calling criteria": "None",
"Active medication Mx": "Link to source/image",
"Active Investigation Orders": '[Pathology:"path text summary", Radiology:"rad text summary", Other:"other text summary.etc."]'
}, {
"UR": 2631972.000000,
"NAME": "Han, Solo ",
"D.O.B": "\/Date(1996-01-01T00:00:00.000+00:00)\/",
"SEX": "M",
"HOSPITAL_SITE": "Clayton",
"WARD/AREA": "ICU",
"BED_NO": "6",
"ADMITTING SPECIALTY": "General Medicine",
"ADMITTING CONSULTANT": "Doogie Howser",
"PATIENT CLINICAL DETAILS": "Click to expand",
"ALLERGIES/ADR": "Penecillin",
"ISOLATION PRECAUTIONS": "none",
"ALERTS": "none",
"DOSING WEIGHT": "X kg",
"ENCOUNTER CLINICAL DETAILS": "Click to expand",
"Goals of care status": "Pending",
"Current Problem List": "[Problem A, Problem B Problem C]",
"Chief complaint": "Chief compliant summary",
"Current referrals": "[Referral A:Status A, Referral B:Status B, Referral C:Status C]",
"Barriers to Discharge": "Text summary",
"EDD": "To be confirmed",
"Confirmed Discharge": "TBC",
"Discharge Destination": "TBC",
"Diet": "Normal",
"Last known vitals": "[BP:Value A, HR:Value B, Temp:Value C]",
"Altered calling criteria": "None",
"Active medication Mx": "Link to source/image",
"Active Investigation Orders": '[Pathology:"path text summary", Radiology:"rad text summary", Other:"other text summary.etc."]'
}, {
"UR": 2637956.000000,
"NAME": "Armstrong, Niel ",
"D.O.B": "\/Date(1997-01-01T00:00:00.000+00:00)\/",
"SEX": "M",
"HOSPITAL_SITE": "Clayton",
"WARD/AREA": "ICU",
"BED_NO": "6",
"ADMITTING SPECIALTY": "General Medicine",
"ADMITTING CONSULTANT": "Doogie Howser",
"PATIENT CLINICAL DETAILS": "Click to expand",
"ALLERGIES/ADR": "Penecillin",
"ISOLATION PRECAUTIONS": "none",
"ALERTS": "none",
"DOSING WEIGHT": "X kg",
"ENCOUNTER CLINICAL DETAILS": "Click to expand",
"Goals of care status": "Pending",
"Current Problem List": "[Problem A, Problem B Problem C]",
"Chief complaint": "Chief compliant summary",
"Current referrals": "[Referral A:Status A, Referral B:Status B, Referral C:Status C]",
"Barriers to Discharge": "Text summary",
"EDD": "To be confirmed",
"Confirmed Discharge": "TBC",
"Discharge Destination": "TBC",
"Diet": "Normal",
"Last known vitals": "[BP:Value A, HR:Value B, Temp:Value C]",
"Altered calling criteria": "None",
"Active medication Mx": "Link to source/image",
"Active Investigation Orders": '[Pathology:"path text summary", Radiology:"rad text summary", Other:"other text summary.etc."]'
}, {
"UR": 873923.000000,
"NAME": "Ice, Tea ",
"D.O.B": "\/Date(1998-01-01T00:00:00.000+00:00)\/",
"SEX": "M",
"HOSPITAL_SITE": "Clayton",
"WARD/AREA": "ID",
"BED_NO": "6",
"ADMITTING SPECIALTY": "General Medicine",
"ADMITTING CONSULTANT": "Doogie Howser",
"PATIENT CLINICAL DETAILS": "Click to expand",
"ALLERGIES/ADR": "Penecillin",
"ISOLATION PRECAUTIONS": "none",
"ALERTS": "none",
"DOSING WEIGHT": "X kg",
"ENCOUNTER CLINICAL DETAILS": "Click to expand",
"Goals of care status": "Pending",
"Current Problem List": "[Problem A, Problem B Problem C]",
"Chief complaint": "Chief compliant summary",
"Current referrals": "[Referral A:Status A, Referral B:Status B, Referral C:Status C]",
"Barriers to Discharge": "Text summary",
"EDD": "To be confirmed",
"Confirmed Discharge": "TBC",
"Discharge Destination": "TBC",
"Diet": "Normal",
"Last known vitals": "[BP:Value A, HR:Value B, Temp:Value C]",
"Altered calling criteria": "None",
"Active medication Mx": "Link to source/image",
"Active Investigation Orders": '[Pathology:"path text summary", Radiology:"rad text summary", Other:"other text summary.etc."]'
}, {
"UR": 893723.000000,
"NAME": "Chapelle, Dave ",
"D.O.B": "\/Date(1999-01-01T00:00:00.000+00:00)\/",
"SEX": "M",
"HOSPITAL_SITE": "Clayton",
"WARD/AREA": "AMU",
"BED_NO": "6",
"ADMITTING SPECIALTY": "General Medicine",
"ADMITTING CONSULTANT": "Doogie Howser",
"PATIENT CLINICAL DETAILS": "Click to expand",
"ALLERGIES/ADR": "Penecillin",
"ISOLATION PRECAUTIONS": "none",
"ALERTS": "none",
"DOSING WEIGHT": "X kg",
"ENCOUNTER CLINICAL DETAILS": "Click to expand",
"Goals of care status": "Pending",
"Current Problem List": "[Problem A, Problem B Problem C]",
"Chief complaint": "Chief compliant summary",
"Current referrals": "[Referral A:Status A, Referral B:Status B, Referral C:Status C]",
"Barriers to Discharge": "Text summary",
"EDD": "To be confirmed",
"Confirmed Discharge": "TBC",
"Discharge Destination": "TBC",
"Diet": "Normal",
"Last known vitals": "[BP:Value A, HR:Value B, Temp:Value C]",
"Altered calling criteria": "None",
"Active medication Mx": "Link to source/image",
"Active Investigation Orders": '[Pathology:"path text summary", Radiology:"rad text summary", Other:"other text summary.etc."]'
}]
}};

//import { hello } from './module.js';
//import list from './script.js';
//import list from 'http://127.0.0.1:5500/script.js';

//manage column visibility
var colVisibility2 = Object.keys(list.REC.PAT[0]);
if(localStorage.colVisibility2 === undefined) {
	for (i = 0; i < colVisibility2.length; i++){
		if (/DETAILS/.test(colVisibility2[i]) || 
		/UR/.test(colVisibility2[i]) || 
		/NAME/.test(colVisibility2[i]) || 
		/D.O.B/.test(colVisibility2[i]) || 
		/SEX/.test(colVisibility2[i]) || 
		/BED_NO/.test(colVisibility2[i]) || 
		/ADMITTING SPECIALTY/.test(colVisibility2[i]) ||	 
		/ADMITTING CONSULTANT/.test(colVisibility2[i])){
			colVisibility2[i] = true;
		}else{
			colVisibility2[i] = false;
		}
	}
	localStorage.setItem("colVisibility2", JSON.stringify(colVisibility2));
}else{
	colVisibility2 = JSON.parse(localStorage.getItem("colVisibility2"));
}
console.log("initial:", JSON.parse(localStorage.getItem("colVisibility2")));
//console.log("colVisibility2:" + colVisibility2);




//Set the width of the sidebar to 250px and the left margin of the page content to 250px
function openNav1() {
  document.getElementById("mySidebar").style.paddingLeft = "5px";
  document.getElementById("mySidebar").style.width = "250px";
  document.getElementById("main").style.marginLeft = "270px";
}

function closeNav1() {
  document.getElementById("mySidebar").style.width = "0";
  document.getElementById("main").style.marginLeft= "0";
}

//Set the width of the sidebar to 250px and the left margin of the page content to 250px
function openNav2() {
  document.getElementById("mySidebar2").style.paddingLeft = "5px";
  document.getElementById("mySidebar2").style.width = "250px";
  document.getElementById("main").style.marginLeft = "270px";
}

function closeNav2() {
  document.getElementById("mySidebar2").style.width = "0";
  document.getElementById("main").style.marginLeft= "0";
}

//create each option for drop down list using list object, text to display and option value
function createOption(ddl, text, value) {
        var opt = document.createElement('option');
        opt.value = value;
        opt.text = text;
		ddl.options.add(opt);
		if (value.endsWith("FLAG")){
			opt.style.display = "none";
		}
    }

//create multiple options by passing drop down list object and array of options
function createOptions(optionsArray, ddl) {
	for (i = 0; i < optionsArray.length; i++) {
		createOption(ddl, optionsArray[i], optionsArray[i]);
	}
}

//construct specific drop down list object using string as selector
function constructDropDown(selector) {
	//console.log("creating drop downs");	
	var headings = [];
	var options;
	const hospitals = new Map();
	const areawards = new Map();
	switch(selector){
		case "cols":
			headings = Object.keys(list.REC.PAT[0]);
			options = document.getElementById("filterDropDown");
			if(options){
				options.innerHTML = "";
			}
			//console.log("cols:" + headings);
			createOptions(headings, options);
			break;
		case "hospitals":
			headings.push("All Hospitals");
			for (let i = 0; i < list.REC.PAT.length; i++) {
				if(!hospitals.has(list.REC.PAT[i]["HOSPITAL_SITE"])){
						hospitals.set(list.REC.PAT[i]["HOSPITAL_SITE"], true);
						headings.push(list.REC.PAT[i]["HOSPITAL_SITE"]);
				}
			}
			options = document.getElementById("locfilter1DropDown");
			options.innerHTML = "";
			options.onchange = function() { filterLoc(i); };
			//console.log("hospitals:" + headings);
			createOptions(headings, options);
			break;
		case "ward/areas":
			headings.push("All Areas/Wards");
			for (let i = 0; i < list.REC.PAT.length; i++) {	
				if(!areawards.has(list.REC.PAT[i]["WARD/AREA"])){
						areawards.set(list.REC.PAT[i]["WARD/AREA"], true);
						headings.push(list.REC.PAT[i]["WARD/AREA"]);
				}
			}
			options = document.getElementById("locfilter2DropDown");
			options.innerHTML = "";
			options.onchange = function() { filterLoc(i); };
			//console.log("areawards:" + headings);
			createOptions(headings, options);
			break;
		default:
			break;
	}
}

//filter table after change in location drop down selection
function filterLoc(selector) {
	//console.log("filtering table by location");
	var hospital, wardarea, table, tr, td, i, txtValue, txtValue2, hospitalCol, wardareaCol, headers;
	hospital = document.getElementById("locfilter1DropDown").value;
	wardarea = document.getElementById("locfilter2DropDown").value;
	table = document.getElementById("table");
	//need to dynamically find hospital and wardarea col using search
	headers = table.tHead.children[0].children;
	for (i = 0; i < headers.length; i++) {
		if (/HOSPITAL_SITE/.test(headers[i].innerHTML)){
			hospitalCol = i;
			//console.log("hospitalCol: ", hospitalCol);
		}else if (/WARD\/AREA/.test(headers[i].innerHTML)){
			wardareaCol = i;
			//console.log("wardareaCol: ", wardareaCol);
		}else{
		}
		
	}
	tr = table.getElementsByTagName("tr");
	//iterate throug table rows
	for (i = 1; i < tr.length; i++) {
		td = tr[i].getElementsByTagName("td")[hospitalCol];
		td2 = tr[i].getElementsByTagName("td")[wardareaCol];
		//check if a hospital location has been selected
		if (!/All Hospitals/.test(hospital)){
			if (td) {
				txtValue = td.textContent || td.innerText;
				if (txtValue.indexOf(hospital) > -1) {
					tr[i].style.display = "";
					//check if a wardarea location has been selected
					if(!/All Areas\/Wards/.test(wardarea)){
						if (td2) {
							txtValue2 = td2.textContent || td2.innerText;
							if (txtValue2.indexOf(wardarea) > -1) {
								tr[i].style.display = "";
							} else {
								tr[i].style.display = "none";
							}
						}
					}
				} else {
					tr[i].style.display = "none";
				}
			}
		//check if a hospital location has not been selected by wardarea is
		}else if(!/All Areas\/Wards/.test(wardarea)){
			if (td2) {
				txtValue2 = td2.textContent || td2.innerText;
				if (txtValue2.indexOf(wardarea) > -1) {
					tr[i].style.display = "";
				} else {
					tr[i].style.display = "none";
				}
			}
		//if neither is selected display all rows
		}else{
			tr[i].style.display = "";
		}
	}
}

//construct table object using json object for data
function constructTable(selector) {
	
	//console.log("creating table");
	//console.log(list.REC.PAT[0]);
	document.getElementById("table").innerHTML = "";
	//style table element
    var tbl = document.getElementById("table");
	tbl.style.width = '150px';
	tbl.style.border = '1px solid black';
	const headings = Object.keys(list.REC.PAT[0]);
	
	//fill table cells
	let dob = /D.O.B/;
	let year, month, day, dateString, displayFormat;
	for (let i = 0; i < list.REC.PAT.length; i++) {
		const tr = tbl.insertRow();
		for (let j = 0; j < headings.length; j++) {
			td = tr.insertCell();
			//change sort and display values for DOB field
			if(dob.test(headings[j])){
				year = list.REC.PAT[i][headings[j]].substring(6, 10);
				month = list.REC.PAT[i][headings[j]].substring(11, 13);
				day = list.REC.PAT[i][headings[j]].substring(14, 16);
				dateString = year + month + day;
				td.sortValue = dateString;
				displayFormat = day + "-" + month + "-" + year;
				td.appendChild(document.createTextNode(displayFormat));				
			}else{
				td.appendChild(document.createTextNode(list.REC.PAT[i][headings[j]]));
				td.sortValue = list.REC.PAT[i][headings[j]].toString();
			}
			//mark className for HAZARDOUS to allow css styling
			if(/HAZARDOUS/.test(headings[j])){
				if(/true/.test(list.REC.PAT[i][headings[j]])){					
					td.className = "hazardTrue";
					//td.innerHTML += '<img align="center" width="100%" height="100%" src="http://dummyimage.com/68x68/000/fff" />';
				}else{
					td.className = "hazardFalse";
				}
			}
			td.style.border = '1px solid black';
			//if next heading is a FLAG for conditional formatting use value as a className
			if(j+1 < headings.length){
				if(headings[j+1].endsWith("FLAG")){
					td.className = list.REC.PAT[i][headings[j+1]];
				}
			}
			//add link for patient clinical details
			if(/PATIENT CLINICAL DETAILS/.test(headings[j])){
				td.innerHTML = "";
				var a = document.createElement('a');
				var linkText = document.createTextNode("Click for patient details");
				a.appendChild(linkText);
				a.title = "Patient clinical details link";
				a.href = "./patientClinicalDetails.html?" + i;
				td.appendChild(a);
				function fu() {
					var opened = window.open("");
				    opened.document.write("Your HTML here");
				}
			}
			//add link for encounter clinical details
			if(/ENCOUNTER CLINICAL DETAILS/.test(headings[j])){
				td.innerHTML = "";
				var a = document.createElement('a');
				var linkText = document.createTextNode("Click for patient details");
				a.appendChild(linkText);
				a.title = "Encounter clinical details link";
				a.href = "./encounterClinicalDetails.html?" + i;
				td.appendChild(a);
				function fu() {
					var opened = window.open("");
				    opened.document.write("Your HTML here");
				}
			}
		}
	}
	
	//create table headers
	var header = tbl.createTHead();
	var row = header.insertRow(0);
	var cell;
	for (let i = 0; i < headings.length; i++) {
		cell = row.insertCell();
		cell.onclick =  function() { sortTable(i); };
		cell.innerHTML = headings[i];
		cell.style.fontWeight = 'bold';
		cell.className = "ascdesc";
	}
	
	//hide flag columns
	var tableRows = document.getElementById("table").getElementsByTagName("tr");
	for (var i = 0; i < tableRows.length; i++) {
		for (var j = 0; j < tableRows[i].cells.length; j++) {
			//console.log("checking", localStorage.getItem("colVisibility2"), localStorage.getItem("colVisibility2"), tbl.rows[i].cells[j]);
			if (!JSON.parse(localStorage.getItem("colVisibility2"))[j]){
				//console.log(j, JSON.parse(localStorage.getItem("colVisibility2"))[j]);
				tbl.rows[i].cells[j].style.display = "none";
			}
		}
	}
	document.getElementById("main").appendChild(tbl);
	constructDropDown("cols");
	constructDropDown("hospitals");
	constructDropDown("ward/areas");
}

//load settings sidebar
function loadSettings(){
	//console.log("loading settings sidebar");
	var headings = Object.keys(list.REC.PAT[0]);
	var tracker = document.getElementById("closeNavbtn");
	var separator = document.createElement('br');
	separator.className = "separator";
	tracker.parentNode.insertBefore(separator,tracker.nextSibling);
	var checkBox, label;
	for (i = headings.length-1; i > -1; i--	){
		checkBox = document.createElement('input');
		label = document.createElement('label');
		checkBox.type = "checkbox";
		checkBox.name = headings[i];
		checkBox.value = headings[i];
		checkBox.id = i + ". " + headings[i];
		if(JSON.parse(localStorage.getItem("colVisibility2"))[i]){	
			checkBox.defaultChecked = true;
		}
		label.htmlFor = checkBox.id;
		label.style = "display:block";
		label.appendChild(checkBox);
		label.appendChild(document.createTextNode(headings[i]));
		tracker.parentNode.insertBefore(label,tracker.nextSibling);
		//checkBox.parentNode.insertBefore(label,checkBox.nextSibling);
		if(headings[i].endsWith("FLAG")){
			checkBox.style.display = "none";
			label.style.display = "none";
		}
	}
	label = document.createElement('label');
	label.style = 'font-weight:bold; font-size:larger; margin-bottom: 10px;';
	label.appendChild(document.createTextNode("Visible Columns"));
	tracker.parentNode.insertBefore(label,tracker.nextSibling);
	separator = document.createElement('br');
	separator.className = "separator";
	tracker.parentNode.insertBefore(separator,tracker.nextSibling);
}

//update values based on user settings
function updateSettings(settings){
	//console.log(event);
	//alert(event.target);
	for (i = 0; i < Object.keys(list.REC.PAT[0]).length; i++){
		colVisibility2[i] = event.target[i].checked;
	}
	localStorage.setItem("colVisibility2", JSON.stringify(colVisibility2));
	//console.log("colVisibility2:",colVisibility2);
	console.log("update check:", JSON.parse(localStorage.getItem("colVisibility2")));
	//updateColumnVisibility();
	//constructTable("table");
	//can add validation later
	return true;	
}

//update column visibility
function showHideColumn(colNumber, visible){
	colVisibility2[colNumber] = visible;
}

function updateColumnVisibility(){
	var tableRows = document.getElementById("table").getElementsByTagName("tr");
	for (var i = 0; i < tableRows.length; i++) {
		for (var j = 0; j < tableRows[i].cells.length; j++) {
			tableRows[i].cells[j].style.display = "";
			if (!colVisibility2[j]){	
				tbl.rows[i].cells[j].style.display = "none";
			}
		}
	}
}

//load presets sidebar
function loadPresets(){
	//console.log("loading presets sidebar");
	var headings = Object.keys(list.REC.PAT[0]);
	var tracker = document.getElementById("presetsArea");
	var checkBox, label;
	for (var i = presets.PRESETS.length-1; i > -1; i--){
		//create preset selection
		checkBox = document.createElement('input');
		label = document.createElement('label');
		checkBox.type = "radio";
		checkBox.name = "presets";
		checkBox.value = presets.PRESETS[i].VIEW_NAME;
		checkBox.id = i + ". " + presets.PRESETS[i].VIEW_NAME;
		checkBox.style = "{display:block}";
		checkBox.onchange = function() { selectPreset(this.id); };
		label.htmlFor = checkBox.id;
		label.appendChild(checkBox);
		label.appendChild(document.createTextNode(presets.PRESETS[i].VIEW_NAME));
		label.style = "{display:block}";
		tracker.parentNode.insertBefore(label,tracker.nextSibling);
	}
	label = document.createElement('label');
	label.style = 'font-weight:bold; font-size:larger; margin-bottom: 10px;';
	label.appendChild(document.createTextNode("Select Preset"));
	tracker.parentNode.insertBefore(label,tracker.nextSibling);
}

//update column visibility form using presets
function selectPreset(preset_id){
	//console.log("loading presets sidebar");
	var trimmmedID = preset_id.split(".")[0];
	var headings = Object.keys(list.REC.PAT[0]);
	var checkBox, name;
	//fill form with preset data
	for (var j = headings.length-1; j > -1; j--	){
		name = j + ". " + headings[j];
		checkBox = document.getElementById(name);
		if(presets.PRESETS[trimmmedID][headings[j]]){	
			checkBox.checked = true;
		}else{
			checkBox.checked = false;
		}
	}
}

//search table using selected field from filterDropDown object
//search is restricted by active hospital and wardarea filters
function searchTable(selector) {
	//console.log("searching table");
	var input, filter, table, tr, td, i, txtValue, col, hospitalCol, wardareaCol, hospital, wardarea, hospitalCheck1, wardAreaCheck1, hospitalCheck2, wardAreaCheck2;
	hospital = document.getElementById("locfilter1DropDown").value;
	wardarea = document.getElementById("locfilter2DropDown").value;
	//need to dynamically find hospital and wardarea col using search
	headers = document.getElementById("table").tHead.children[0].children;
	for (i = 0; i < headers.length; i++) {
		if (/HOSPITAL_SITE/.test(headers[i].innerHTML)){
			hospitalCol = i;
			//console.log("hospitalCol: ", hospitalCol);
		}else if (/WARD\/AREA/.test(headers[i].innerHTML)){
			wardareaCol = i;
			//console.log("wardareaCol: ", wardareaCol);
		}else{
		}
		
	}
	input = document.getElementById("searchBar");
	filter = input.value.toUpperCase();
	col = document.getElementById("filterDropDown").selectedIndex;
	table = document.getElementById("table");
	tr = table.getElementsByTagName("tr");
	for (i = 1; i < tr.length; i++) {
		tr[i].style.display = "none";
		td = tr[i].getElementsByTagName("td")[col];
		hospitalCheck1 = tr[i].getElementsByTagName("td")[hospitalCol];
		wardAreaCheck1 = tr[i].getElementsByTagName("td")[wardareaCol];
		hospitalCheck2 = hospitalCheck1.textContent || hospitalCheck1.innerText;
		wardAreaCheck2 = wardAreaCheck1.textContent || wardAreaCheck1.innerText;
		if (td) {
			txtValue = td.textContent || td.innerText;
			if (txtValue.toUpperCase().indexOf(filter) > -1) {
				if(hospital.indexOf(hospitalCheck2) > -1 || /All Hospitals/.test(hospital)){
					if(wardarea.indexOf(wardAreaCheck2) > -1 || /All Areas\/Wards/.test(wardarea)){
						tr[i].style.display = "";
					}
				}
			}
		}
	}
}

function sortTable(n) {
	//console.log("sorting column " + n);
    var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
	table = document.getElementById("table");
	//reset all direction arrows
	for (var a = 0; a < colVisibility2.length; ++a){
		table.children[0].children[0].children[a].className = "ascdesc";
	}
	//console.log(table.children[0].children[0]);
	switching = true;
	// Set the sorting direction to ascending:
	dir = "asc";
	/* Make a loop that will continue until
	no switching has been done: */
	while (switching) {
		// Start by saying: no switching is done:
		switching = false;
		rows = table.rows;
		/* Loop through all table rows (except the
		first, which contains table headers): */
		for (i = 1; i < (rows.length - 1); i++) {
		// Start by saying there should be no switching:
		shouldSwitch = false;
		/* Get the two elements you want to compare,
		one from current row and one from the next: */
		x = rows[i].getElementsByTagName("TD")[n];
		y = rows[i + 1].getElementsByTagName("TD")[n];
		/* Check if the two rows should switch place,
		based on the direction, asc or desc: */
		if (dir == "asc") {
			table.children[0].children[0].children[n].className = "asc";
			if (x.sortValue.toLowerCase() > y.sortValue.toLowerCase()) {
				// If so, mark as a switch and break the loop:
				shouldSwitch = true;
				break;
			}
		}else if (dir == "desc") {
			table.children[0].children[0].children[n].className = "desc";
			if (x.sortValue.toLowerCase() < y.sortValue.toLowerCase()) {
				// If so, mark as a switch and break the loop:
				shouldSwitch = true;
				break;
			}
		  }
		}
		if (shouldSwitch) {
		/* If a switch has been marked, make the switch
		and mark that a switch has been done: */
		rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
		switching = true;
		// Each time a switch is done, increase this count by 1:
		switchcount ++;
		} else {
		/* If no switching has been done AND the direction is "asc",
		set the direction to "desc" and run the while loop again. */
			if (switchcount == 0 && dir == "asc") {
				dir = "desc";
				switching = true;
			}
		}
	  }
}


//construct details table object using json object for data
function constructDetailsTable(selector) {
	
	//console.log("creating table");
	//console.log(list.REC.PAT[0]);
	document.getElementById("table").innerHTML = "";
	//style table element
    var tbl = document.getElementById("table");
	tbl.style.width = '150px';
	tbl.style.border = '1px solid black';
	const headings = Object.keys(list.REC.PAT[0]);
	
	//fill table cells
	let dob = /D.O.B/;
	let year, month, day, dateString;
		var queryString = location.search.substring(1);
		//alert(queryString);
		var i = queryString;
		for (let j = 0; j < headings.length; j++) {
			const tr = tbl.insertRow();
			td = tr.insertCell();
			td.innerHTML = headings[j];
			td.style.fontWeight = 'bold';
			//hide patient details heading
			if(/PATIENT_DETAILS/.test(headings[j])){
				td.style.display = "none"
			}
			td = tr.insertCell();
			//change sort and display values for DOB field
			if(dob.test(headings[j])){
				year = list.REC.PAT[i][headings[j]].substring(6, 10);
				month = list.REC.PAT[i][headings[j]].substring(11, 13);
				day = list.REC.PAT[i][headings[j]].substring(14, 16);
				dateString = year + month + day;
				td.sortValue = dateString;
				td.appendChild(document.createTextNode(list.REC.PAT[i][headings[j]].substring(6, 16)));				
			}else{
				td.appendChild(document.createTextNode(list.REC.PAT[i][headings[j]]));
				td.sortValue = list.REC.PAT[i][headings[j]].toString();
			}
			//mark className for HAZARDOUS to allow css styling
			if(/HAZARDOUS/.test(headings[j])){
				if(/true/.test(list.REC.PAT[i][headings[j]])){					
					td.className = "hazardTrue";
					//td.innerHTML += '<img align="center" width="100%" height="100%" src="http://dummyimage.com/68x68/000/fff" />';
				}else{
					td.className = "hazardFalse";
				}
			}
			td.style.border = '1px solid black';
			//if next heading is a FLAG for conditional formatting use value as a className
			if(j+1 < headings.length){
				if(headings[j+1].endsWith("FLAG")){
					td.className = list.REC.PAT[i][headings[j+1]];
				}
			}
			//hide patient details
			if(/PATIENT_DETAILS/.test(headings[j])){
				td.style.display = "none"
			}
	}
	document.getElementById("main").appendChild(tbl);
}


//construct Patient Clinical details table object using json object for data
function constructPCDetailsTable(selector) {
	
	//console.log("creating table");
	//console.log(list.REC.PAT[0]);
	document.getElementById("table").innerHTML = "";
	//style table element
    var tbl = document.getElementById("table");
	tbl.style.width = '150px';
	tbl.style.border = '1px solid black';
	const headings = Object.keys(list.REC.PAT[0]);
	
	//fill table cells
	let dob = /D.O.B/;
	let year, month, day, dateString;
		var queryString = location.search.substring(1);
		//alert(queryString);
		var i = queryString;
		for (let j = 0; j < headings.length; j++) {
			const tr = tbl.insertRow();
			td = tr.insertCell();
			td.innerHTML = headings[j];
			td.style.fontWeight = 'bold';
			//hide unwanted headings
			if(!/ALLERGIES\/ADR/.test(headings[j]) && 
			!/ISOLATION PRECAUTIONS/.test(headings[j]) && 
			!/ALERTS/.test(headings[j]) && 
			!/DOSING WEIGHT/.test(headings[j])){
				td.style.display = "none"
			}
			td = tr.insertCell();
			//change sort and display values for DOB field
			if(dob.test(headings[j])){
				year = list.REC.PAT[i][headings[j]].substring(6, 10);
				month = list.REC.PAT[i][headings[j]].substring(11, 13);
				day = list.REC.PAT[i][headings[j]].substring(14, 16);
				dateString = year + month + day;
				td.sortValue = dateString;
				td.appendChild(document.createTextNode(list.REC.PAT[i][headings[j]].substring(6, 16)));				
			}else{
				td.appendChild(document.createTextNode(list.REC.PAT[i][headings[j]]));
				td.sortValue = list.REC.PAT[i][headings[j]].toString();
			}
			//mark className for HAZARDOUS to allow css styling
			if(/HAZARDOUS/.test(headings[j])){
				if(/true/.test(list.REC.PAT[i][headings[j]])){					
					td.className = "hazardTrue";
					//td.innerHTML += '<img align="center" width="100%" height="100%" src="http://dummyimage.com/68x68/000/fff" />';
				}else{
					td.className = "hazardFalse";
				}
			}
			td.style.border = '1px solid black';
			//if next heading is a FLAG for conditional formatting use value as a className
			if(j+1 < headings.length){
				if(headings[j+1].endsWith("FLAG")){
					td.className = list.REC.PAT[i][headings[j+1]];
				}
			}
			//hide unwanted details
			if(!/ALLERGIES\/ADR/.test(headings[j]) && 
			!/ISOLATION PRECAUTIONS/.test(headings[j]) && 
			!/ALERTS/.test(headings[j]) && 
			!/DOSING WEIGHT/.test(headings[j])){
				td.style.display = "none"
			}
	}
	document.getElementById("main").appendChild(tbl);
}


//construct Encounter Clinical Details table object using json object for data
function constructECDetailsTable(selector) {
	
	//console.log("creating table");
	//console.log(list.REC.PAT[0]);
	document.getElementById("table").innerHTML = "";
	//style table element
    var tbl = document.getElementById("table");
	tbl.style.width = '150px';
	tbl.style.border = '1px solid black';
	const headings = Object.keys(list.REC.PAT[0]);
	
	//fill table cells
	let dob = /D.O.B/;
	let year, month, day, dateString;
		var queryString = location.search.substring(1);
		//alert(queryString);
		var i = queryString;
		for (let j = 0; j < headings.length; j++) {
			const tr = tbl.insertRow();
			td = tr.insertCell();
			td.innerHTML = headings[j];
			td.style.fontWeight = 'bold';
			//hide unwanted headings
			if(!/Goals of care status/.test(headings[j]) && 
			!/Current Problem List/.test(headings[j]) && 
			!/Chief complaint/.test(headings[j]) && 
			!/Current referrals/.test(headings[j]) && 
			!/Barriers to Discharge/.test(headings[j]) && 
			!/EDD/.test(headings[j]) && 
			!/Confirmed Discharge/.test(headings[j]) && 
			!/Discharge Destination/.test(headings[j]) && 
			!/Diet/.test(headings[j]) && 
			!/Last known vitals/.test(headings[j]) && 
			!/Altered calling criteria/.test(headings[j]) && 
			!/Active medication Mx/.test(headings[j]) && 
			!/Active Investigation Orders/.test(headings[j])){
				td.style.display = "none"
			}
			td = tr.insertCell();
			//change sort and display values for DOB field
			if(dob.test(headings[j])){
				year = list.REC.PAT[i][headings[j]].substring(6, 10);
				month = list.REC.PAT[i][headings[j]].substring(11, 13);
				day = list.REC.PAT[i][headings[j]].substring(14, 16);
				dateString = year + month + day;
				td.sortValue = dateString;
				td.appendChild(document.createTextNode(list.REC.PAT[i][headings[j]].substring(6, 16)));				
			}else{
				td.appendChild(document.createTextNode(list.REC.PAT[i][headings[j]]));
				td.sortValue = list.REC.PAT[i][headings[j]].toString();
			}
			//mark className for HAZARDOUS to allow css styling
			if(/HAZARDOUS/.test(headings[j])){
				if(/true/.test(list.REC.PAT[i][headings[j]])){					
					td.className = "hazardTrue";
					//td.innerHTML += '<img align="center" width="100%" height="100%" src="http://dummyimage.com/68x68/000/fff" />';
				}else{
					td.className = "hazardFalse";
				}
			}
			td.style.border = '1px solid black';
			//if next heading is a FLAG for conditional formatting use value as a className
			if(j+1 < headings.length){
				if(headings[j+1].endsWith("FLAG")){
					td.className = list.REC.PAT[i][headings[j+1]];
				}
			}
			//hide unwanted details
			if(!/Goals of care status/.test(headings[j]) && 
			!/Current Problem List/.test(headings[j]) && 
			!/Chief complaint/.test(headings[j]) && 
			!/Current referrals/.test(headings[j]) && 
			!/Barriers to Discharge/.test(headings[j]) && 
			!/EDD/.test(headings[j]) && 
			!/Confirmed Discharge/.test(headings[j]) && 
			!/Discharge Destination/.test(headings[j]) && 
			!/Diet/.test(headings[j]) && 
			!/Last known vitals/.test(headings[j]) && 
			!/Altered calling criteria/.test(headings[j]) && 
			!/Active medication Mx/.test(headings[j]) && 
			!/Active Investigation Orders/.test(headings[j])){
				td.style.display = "none"
			}
	}
	document.getElementById("main").appendChild(tbl);
}

//add name for details pages
function getName(){
	const headings = Object.keys(list.REC.PAT[0]);
	var ur, name;
	var queryString = location.search.substring(1);
	var i = queryString;
	for (let j = 0; j < headings.length; j++) {
			//get details
			if(/UR/.test(headings[j])){
				ur = list.REC.PAT[i][headings[j]];
			}
			if(/NAME/.test(headings[j])){
				name = list.REC.PAT[i][headings[j]];
			}
		document.getElementById("name_ph").innerHTML = "UR: " + ur + "<br />" + "Name: " + name;
	}
}
